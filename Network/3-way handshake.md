# 3-way handshake & 4-way handshake
- `TCP` 는 Connection-Oriented (연결 지향) 프로토콜이다. 이 말은 프로토콜에 의해 연속적으로 패킷의 상태 정보를 확인하고 유지하는 것을 기본으로 한다고 생각할 수 있다.
<br><br>

## 3-way handshake - 연결 성립
- `TCP` 는 정확한 전송을 보장해야 한다. 따라서 통신하기에 앞서, 연결이 성립하기 위해 `3-way handshake` 과정을 진행한다.
![](https://images.velog.io/images/sangwoo24/post/5149bb41-eeb8-4b77-a4cf-950831dd21e5/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-05-07%20%EC%98%A4%ED%9B%84%205.41.51.png)

1. 클라이언트는 서버에 접속을 요청하는 `SYN(M)` 패킷을 보낸다.
2. 서버는 클라이언트의 요청인 `SYN(M)` 을 받고, 클라이언트에게 요청을 수락한다는 `ACK(M+1)` 과 `SYN(N)` 이 설정된 패킷을 발송한다.
3. 클라이언트는 서버의 수락 응답인 `ACK(M+1)` 과 `SYN(N)` 패킷을 받고, 서버로 `ACK(N+1)` 를 서버로 보내면 **연결이 성립(establish)** 된다.
<br><br><br>

## 4-way handshake - 연결 해제

![](https://images.velog.io/images/sangwoo24/post/09d2bed1-609a-4a37-9129-822260a9209c/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-05-07%20%EC%98%A4%ED%9B%84%205.46.06.png)

1. 클라이언트가 연결을 종료하겠다는 `FIN 플래그` 를 전송한다.
2. 서버는 클라이언트의 요청(FIN) 을 받고, 확인 메세지로 `ACK` 를 보낸다.
    - 데이터를 모두 보낼 때까지 잠간 `TIME OUT` 이 된다.
3. 데이터를 모두 보내고 통신이 끝났으면, 연결이 종료되었다고 클라이언트에게 `FIN 플래그` 를 전송한다.
4. 클라이언트는 FIN 메세지 를 확인했다는 `ACK` 메세지를 보낸다.
5. 클라이언트의 ACK 메세지를 받은 서버는 **소켓 연결을 Close** 한다.
6. 클라이언트는 아직 서버로부터 받지 못한 데이터가 있을 것을 대비해 **일정 시간 동안 세션을 남겨놓고 잉여 패킷을 기다리는 과정(`TIME WAIT`) 을 거친다.**
    